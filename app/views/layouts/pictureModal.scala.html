@import java.time.LocalDateTime
@(picture: Picture)(implicit form: DynamicForm, request: play.mvc.Http.Request)
<div class="modal fade" id="pictureModal" tabindex="-1" role="dialog" aria-labelledby="pictureModalTitle" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered pictureModal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="pictureModalTitle">@picture.getPictureCaption</h5>
				<button type="button" class="btn btn-outline-danger circle btn-close center" data-dismiss="modal" aria-label="Close">
					<i class="fas fa-times-circle"></i>
				</button>
			</div>
			<div class="modal-body">
				<div class="card pictureModal-card">
					<div class="row no-gutters center">
						<div class="pictureModal-picture">
							<img src="@routes.PictureController.getPicture(picture.getPictureId, isFullSize = true)" class="card-img pictureModal-picture" alt="Error loading">
						</div>
						<div class="pictureModal-content">
							<div class="card-body pictureModal-comments overflow-auto">
							@for(mapPictureComments : (LocalDateTime,Comment) <- MappingController.mapPictureComments(picture)){
								<div class="card-body pictureModal-comments overflow-auto">
									<p class="card-text">
									@layouts.formFields.pictureBox(mapPictureComments._2.getCommentator.getProfilePicture(), "size-60")
									@mapPictureComments._2.getCommentContent
									<p>
								</div>
							}
							</div>
							<div>
								<form action='@routes.PictureController.newCommentAction(picture.getPictureId)' method="post" class="pictureModal-newComment" id="submitComment">
									<fieldset hidden>@helper.CSRF.formField</fieldset>
									<fieldset class="text-left">
										@layouts.formFields.textArea("commentContent", "New comment", 3, 250, form("commentContent"), isRequired = true, "mb-1 pb-1")
										<input id='submitButton' type="button" class="form-button mt-0" value="Upload">
									</fieldset>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">

	$(function() {
		var $pictureModal = $("#pictureModalLoader");
		var $pictureModalBtn = $("#pictureModalDisplay");
		$("#submitButton").click(function (e) {


			var data = $('#submitComment').serialize();
			e.preventDefault();
			e.stopPropagation();
			$.ajax({
				type: "POST",
				url: '@routes.PictureController.newCommentAction(picture.getPictureId)' ,
				data : data,
				success: function(){
					$pictureModal.load('@routes.ViewsController.index()' + "picture/view/@picture.getPictureId", function(){$pictureModalBtn.click();});
				}
			});


		});
	});
</script>